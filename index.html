<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comparación de Autos Eléctricos</title>
    <link rel="stylesheet" href="styles.css"> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>

    <div class="container">
        <div class="header">
            <img src="imagenes/logo.jpg" alt="Logo" class="logo"> 
            <div class="title">Autos Electricos</div>

            <label for="category-select">Selecciona la categoría:</label>
            <select id="category-select" class="pulse-effect">
                <option value="Battery_kWh">Batería</option>
                <option value="Acceleration_sec">Aceleración</option>
                <option value="TopSpeed_kmh">Velocidad Máxima</option>
                <option value="Range_km">Autonomía</option>
                <option value="Efficiency_Whkm">Gasto</option>
                <option value="NumberofSeats">Número de asientos</option>
                <option value="Score">Puntuación</option>
            </select>
        </div>

        <div class="main-content">
            <!-- Columna de contexto -->
            <div class="contexto">
                <h2>Comparación de Precios y Rendimiento de Autos Eléctricos</h2>
                <p>En esta página encontrarás una comparación detallada entre el precio de distintos modelos de autos eléctricos y sus características clave de rendimiento, como la capacidad de la batería, aceleración, velocidad máxima y más. Nuestro objetivo es brindarte una herramienta que te permita evaluar fácilmente cómo el costo de cada vehículo se relaciona con sus especificaciones técnicas, ayudándote a tomar decisiones informadas al momento de elegir el auto eléctrico que mejor se ajuste a tus necesidades.</p>
                <p>Cada gráfico te permitirá visualizar cómo varían los precios en función de distintos atributos de rendimiento, dándote una visión completa de las opciones disponibles en el mercado. Esta información te será útil si deseas encontrar el equilibrio ideal entre el costo y las prestaciones de los vehículos eléctricos actuales.</p>
            </div>

            <!-- Columna de gráfico -->
            <div class="graphic">
                <div id="chart-container">
                    <canvas id="line-chart"></canvas>
                </div>

                <!-- Contenedor para mostrar las especificaciones del auto -->
                <div id="car-details" class="car-details">
                    <h3>Detalles del Auto</h3>
                    <p id="car-specs"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let chart;  // Para mantener referencia al gráfico

        document.addEventListener('DOMContentLoaded', function() {
            const carDetails = document.getElementById('car-details'); // Contenedor para los detalles del auto
            const carSpecs = document.getElementById('car-specs'); // Donde se mostrarán las especificaciones

            // Cargar el CSV
            Papa.parse('datos/database.csv', {
                download: true,
                header: true,
                complete: function(results) {
                    const data = results.data.map(item => {
                        return {
                            Name: item.Name,
                            Price: parseInt(item.PriceinEurope), // Convertir a número
                            Battery_kWh: parseFloat(item.Battery_kWh),
                            Acceleration_sec: parseFloat(item.Acceleration_sec),
                            TopSpeed_kmh: parseFloat(item.TopSpeed_kmh),
                            Range_km: parseFloat(item.Range_km),
                            Efficiency_Whkm: parseFloat(item.Efficiency_Whkm),
                            NumberofSeats: parseInt(item.NumberofSeats),
                            Score: Math.trunc(parseFloat(item.Score) * 100),
                        };
                    });

                    // Inicializar el gráfico
                    actualizarGrafico('Battery_kWh', data);
                },
                error: function(err) {
                    console.error('Error al cargar el archivo CSV:', err);
                }
            });

            // Función para actualizar el gráfico según la categoría seleccionada
            function actualizarGrafico(categoria, data) {
                const precios = data.map(item => item.Price); // Obtiene los precios
                const valores = data.map(item => item[categoria]); // Obtiene los valores de la categoría seleccionada

                // Si ya existe un gráfico, destrúyelo antes de crear uno nuevo
                if (chart) {
                    chart.destroy();
                }

                // Crear el gráfico
                const ctx = document.getElementById('line-chart').getContext('2d');
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: precios, // Usar los precio de los autos en el eje X
                        datasets: [{
                            label: categoria,
                            data: valores, // Datos de la categoría en el eje Y
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 2,
                            fill: false,
                            hoverBackgroundColor: 'rgba(255, 99, 132, 0.2)',
                            hoverBorderColor: 'rgba(255, 99, 132, 1)',
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Precio en Europa'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: categoria
                                }
                            }
                        },
                        // Personalización del tooltip para mostrar el nombre del auto y el precio
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    // El título el valor del eje Y (el dato graficado)
                                    title: function(context) {
                                        const valor = context[0].raw; // Obtener el valor del eje Y
                                        return valor.toFixed(2); // Muestra el valor del eje Y como título
                                    },
                                    // La etiqueta el nombre del auto y su precio
                                    label: function(context) {
                                        const index = context.dataIndex;
                                        const name = data[index].Name; // Obtener el nombre del auto
                                        const price = context.label; // Obtener el precio (eje X)
                                        return `${name}: €${parseFloat(price).toLocaleString()}`;
                                    }
                                }
                            }
                        },
                        // Al hacer clic en un punto del gráfico, mostrar los detalles del auto
                        onClick: function(e, item) {
                            if (item.length > 0) {
                                const index = item[0].index; // Obtener el índice del auto
                                const car = data[index]; // Obtener los datos del auto

                                // Mostrar las especificaciones del auto
                                carDetails.style.display = 'block'; // Hacer visible el contenedor
                                carSpecs.innerHTML = `
                                    <strong>Nombre:</strong> ${car.Name}<br>
                                    <strong>Precio:</strong> €${car.Price.toLocaleString()}<br>
                                    <strong>Batería:</strong> ${car.Battery_kWh} kWh<br>
                                    <strong>Aceleración:</strong> ${car.Acceleration_sec} segundos<br>
                                    <strong>Velocidad Máxima:</strong> ${car.TopSpeed_kmh} km/h<br>
                                    <strong>Autonomía:</strong> ${car.Range_km} km<br>
                                    <strong>Gasto:</strong> ${car.Efficiency_Whkm} Wh/km<br>
                                    <strong>Número de Asientos:</strong> ${car.NumberofSeats}<br>
                                    <strong>Puntuación:</strong> ${car.Score}<br>
                                `;
                            }
                        }
                    }
                });
            }
        });
    </script>

</body>
</html>
